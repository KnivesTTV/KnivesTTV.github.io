<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Budget Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #calculator {
      background-color: #fff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    label {
      display: block;
      margin-bottom: 5px;
    }

    input {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 3px;
    }

    #result {
      font-weight: bold;
      margin-top: 10px;
    }

    .category {
      display: flex;
      justify-content: space-between;
      width: 100%;
      padding: 5px 0;
      border-bottom: 1px solid #ccc;
    }

    .category-name {
      font-weight: bold;
      flex: 1;
    }

    .category-amount {
      flex: 1;
      text-align: right;
    }

    .category.total {
      font-size: 1.2em;
      margin-top: 10px;
      border-top: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <div id="calculator">
    <h2>Budget Calculator</h2>
    <form id="budget-form">
      <label for="income">Basic Salary (in pesos):</label>
      <input type="number" id="income" min="0" step="1">
      
      <label for="non-taxable-allowance">Non-taxable Allowance (in pesos):</label>
      <input type="number" id="non-taxable-allowance" min="0" step="1" placeholder="Enter non-taxable allowance">
    </form>
    <div id="result"></div>
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.getElementById("budget-form");
      const resultDiv = document.getElementById("result");

      form.addEventListener("input", calculateBudget);

      function formatCurrency(amount) {
        return new Intl.NumberFormat("en-PH", { style: "currency", currency: "PHP" }).format(amount);
      }


      function calculateWithholdingTax(monthlySalary) {
        // Define the corrected tax brackets and rates
        const taxBrackets = [
            { limit: 10416.66666666666, rate: 0 },
            { limit: 20833.33333333333, rate: 0.05 },
            { limit: 33333.33333333333, rate: 0.10 },
            { limit: 66666.66666666666, rate: 0.15 },
            { limit: 166666.6666666666, rate: 0.20 },
            { limit: 666666.6666666666, rate: 0.25 },
            { limit: Infinity, rate: 0.30 }
        ];
    
        // Initialize the total tax
        let totalTax = 0;
    
        // Calculate tax progressively
        for (const bracket of taxBrackets) {
            if (monthlySalary <= bracket.limit) {
                // Calculate tax for this bracket
                const taxableAmount = Math.max(0, monthlySalary - (bracket.limit - 10416.666666666));
                const taxForBracket = taxableAmount * bracket.rate;
                totalTax += taxForBracket;
                break; // Exit the loop once tax is calculated
            } else {
                // Calculate tax for the full bracket
                const taxableAmount = Math.max(0, bracket.limit - 10416.67);
                const taxForBracket = taxableAmount * bracket.rate;
                totalTax += taxForBracket;
            }
        }
    
        return totalTax;
    }
    


      function calculateSSSContribution(basicSalary) {
        if (basicSalary <= 10000) {
          return 400;
        } else if (basicSalary >= 20000) {
          return 1350;
        } else {
          return basicSalary * 0.045;
        }
      }

      function calculatePhilHealthContribution(basicSalary) {
        if (basicSalary <= 10000) {
          return 200;
        } else if (basicSalary >= 80000) {
          return 1600;
        } else {
          return basicSalary * 0.025;
        }
      }

      function calculatePagIbigContribution(basicSalary) {
        return 200;
      }

      function calculateBudget() {
        const basicSalary = parseFloat(document.getElementById("income").value) || 0;
       
        const nonTaxableAllowance = parseFloat(document.getElementById("non-taxable-allowance").value) || 0;

        const monthlySalary = basicSalary + nonTaxableAllowance;
        const withholdingTax = calculateWithholdingTax(monthlySalary);
        const sssContribution = calculateSSSContribution(basicSalary);
        const philHealthContribution = calculatePhilHealthContribution(basicSalary);
        const pagIbigContribution = calculatePagIbigContribution(basicSalary);
        const totalDeductions = withholdingTax + sssContribution + philHealthContribution + pagIbigContribution;
        const netPay = monthlySalary - totalDeductions;

        const categories = [
          { name: "Basic Salary", amount: basicSalary },
          { name: "Non-taxable Allowance", amount: nonTaxableAllowance },
          { name: "Monthly Salary", amount: monthlySalary },
          { name: "Withholding Tax", amount: withholdingTax },
          { name: "SSS Contribution", amount: sssContribution },
          { name: "PhilHealth Contribution", amount: philHealthContribution },
          { name: "PAG-IBIG Contribution", amount: pagIbigContribution },
          { name: "Total Deductions", amount: totalDeductions },
          { name: "Net Pay", amount: netPay },
        ];

        const defaultPercentages = [
          { name: "Housing", percentage: 0.2 },
          { name: "Transportation", percentage: 0.08 },
          { name: "Food", percentage: 0.15 },
          { name: "Utilities", percentage: 0.09 },
          { name: "Insurance", percentage: 0.05 },
          { name: "Medical & Healthcare", percentage: 0.07 },
          { name: "Savings, Investing, & Debt Payments", percentage: 0.3 },
          { name: "Personal & Recreation", percentage: 0.03 },
          { name: "Miscellaneous", percentage: 0.03 },
        ];

        const totalIncome = netPay;
        const totalPercentage = defaultPercentages.reduce((total, category) => total + category.percentage, 0);
        const adjustedPercentages = defaultPercentages.map((category) => ({
          ...category,
          percentage: category.percentage / totalPercentage,
        }));

        let totalSum = 0;
        let resultHTML = '<div class="result">';
        categories.forEach((category) => {
          resultHTML += `
            <div class="category">
              <span class="category-name">${category.name}:</span>
              <span class="category-amount">${formatCurrency(category.amount)}</span>
            </div>
          `;
        });
    
        resultHTML += '<h3>Budget Categories:</h3>';
    
        adjustedPercentages.forEach((category) => {
          const allocatedAmount = totalIncome * category.percentage;
          const roundedAmount = Math.round(allocatedAmount);
    
          resultHTML += `
            <div class="category">
              <span class="category-name">${category.name}:</span>
              <span class="category-amount">${formatCurrency(roundedAmount)}</span>
            </div>
          `;
    
          totalSum += roundedAmount;
        });
    
        resultHTML += "</div>";
        resultDiv.innerHTML = resultHTML;
      }
    
      calculateBudget();
    });
  </script>
</body>
</html>
